{% extends "app/base_site.html" %}
{% block title %} {% if  "add" == handle %}添加{% else %}编辑{% endif %}行为算法 {% endblock title %}
{% block stylesheets %}
  {{ block.super }}
<style>
    /* 信息卡片 */
    .bh_info_card {
        background: #fff;
        border-radius: 8px;
        padding: 16px 20px;
        margin: 0 auto 16px;
        max-width: 900px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    .bh_card_title {
        font-size: 14px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 1px solid #eef2f5;
    }
    
    .bh_card_title i {
        margin-right: 8px;
        color: #169F85;
        font-size: 16px;
    }
    
    /* 表单组 */
    .bh_form_group {
        margin-bottom: 14px;
    }
    
    .bh_label {
        font-size: 12px;
        color: #606266;
        margin-bottom: 6px;
        display: block;
        font-weight: 500;
    }
    
    .bh_label .required {
        color: #f56c6c;
        margin-left: 2px;
    }
    
    .bh_input, .bh_select, .bh_textarea {
        width: 100%;
        padding: 8px 12px;
        font-size: 13px;
        border: 1px solid #dcdfe6;
        border-radius: 4px;
        transition: border-color 0.2s;
        background: #fff;
    }
    
    .bh_input {
        height: 36px;
    }
    
    .bh_select {
        height: 36px;
    }
    
    .bh_textarea {
        resize: vertical;
        font-family: inherit;
    }
    
    .bh_input:focus, .bh_select:focus, .bh_textarea:focus {
        border-color: #169F85;
        outline: none;
    }
    
    .bh_input:disabled, .bh_select:disabled {
        background: #f5f7fa;
        color: #909399;
        cursor: not-allowed;
    }
    
    /* 按钮组 */
    .bh_actions {
        text-align: center;
        padding-top: 24px;
        border-top: 1px solid #eef2f5;
        margin-top: 8px;
    }
    
    .bh_btn {
        min-width: 100px;
        height: 38px;
        padding: 0 24px;
        font-size: 14px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        margin: 0 8px;
    }
    
    .bh_btn_cancel {
        background: #fff;
        border: 1px solid #dcdfe6;
        color: #606266;
    }
    
    .bh_btn_cancel:hover {
        color: #169F85;
        border-color: #169F85;
        background: #f0f9f6;
    }
    
    .bh_btn_submit {
        background: linear-gradient(135deg, #169F85 0%, #14b89a 100%);
        color: #fff;
    }
    
    .bh_btn_submit:hover {
        box-shadow: 0 3px 8px rgba(22, 159, 133, 0.3);
        transform: translateY(-1px);
    }
</style>
{% endblock stylesheets %}

{% block content %}

  <div class="right_col" role="main">
    <div class="">
      <div class="row">
        <div class="col-md-12 col-xs-12">
          <div class="x_panel">
            <div class="x_title">
                <h2>{% if  "add" == handle %}添加{% else %}编辑{% endif %}行为算法
                 <span id="top_msg">{{top_msg}}</span>
                </h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              
              <!-- 行为算法信息卡片 -->
              <div class="bh_info_card">
                <div class="bh_card_title">
                  <i class="fa fa-cogs"></i>行为算法配置
                </div>
                
                <form id="behaviourForm" method="post" enctype="multipart/form-data">
                  <input type="hidden" name="handle" value="{{ handle }}">
                  <input type="hidden" name="code" value="{{ behaviour.code }}">
                  
                  <div class="bh_form_group">
                    <label class="bh_label">算法编号</label>
                    <input type="text" value="{{ behaviour.code }}" class="bh_input" disabled>
                  </div>

                  <div class="bh_form_group">
                    <label class="bh_label">算法名称<span class="required">*</span></label>
                    <input type="text" name="name" value="{{ behaviour.name }}" class="bh_input" placeholder="请输入算法名称">
                  </div>
                  
                  {% if "edit" == handle %}<input type="hidden" name="way_code" value="{{ behaviour.way_code }}">{% endif %}

                  <div class="bh_form_group">
                    <label class="bh_label">请选择接入方式<span class="required">*</span></label>
                    <select name="way_code" {% if "edit" == handle %}disabled{% endif %} class="bh_select">
                      <option value="0">请选择</option>
                      {% for way in behaviour_ways %}
                        {% if behaviour.way_code == way.code %}
                          <option selected value="{{ behaviour.way_code }}">{{ way.name }}</option>
                        {% else %}
                          <option value="{{ way.code }}">{{ way.name }}</option>
                        {% endif %}
                      {% endfor %}
                    </select>
                  </div>

                  <div class="bh_form_group">
                    <label class="bh_label">接入参数<span class="required">*</span></label>
                    <textarea name="way_value" class="bh_textarea" rows="2" placeholder="请输入接入参数">{{ behaviour.way_value }}</textarea>
                  </div>

                  <div class="bh_form_group">
                    <label class="bh_label">扩展参数</label>
                    <textarea name="extend_params" class="bh_textarea" rows="3" placeholder="请输入扩展参数（可选）">{{ behaviour.extend_params }}</textarea>
                  </div>

                  <div class="bh_actions">
                    <button type="button" onclick="window.history.go(-1)" class="bh_btn bh_btn_cancel">
                      返回
                    </button>
                    <button type="submit" class="bh_btn bh_btn_submit">
                       提交
                    </button>
                  </div>
                </form>
              </div>
              
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
{% endblock content %}

{% block javascripts %}
  {{ block.super }}
<script>
let handle = "{{ handle }}";
let behaviour_code = "{{ behaviour.code }}";
let ele_input_name = $("input[name='name']");
let ele_select_way_code = $("select[name='way_code']");
let ele_textarea_way_value = $("textarea[name='way_value']");

$(document).ready(function () {
  $("#behaviourForm").submit(function (e) {
    e.preventDefault();
    
    if(ele_input_name.val().trim() === ""){
      myToast2025("请输入算法名称", "error");
      return false;
    }
    if(ele_select_way_code.val().trim() === "0"){
      myToast2025("请选择接入方式", "error");
      return false;
    }
    let way_value = ele_textarea_way_value.val().trim();
    if(way_value === "0" || way_value === ""){
      myToast2025("请输入接入参数", "error");
      return false;
    }
    
    // 验证通过，提交表单
    this.submit();
  });
});
</script>
{% endblock javascripts %}
