<div class="left_col scroll-view" style="background-color: #1a1a2e;">
  <div class="navbar nav_title" style="border: 0; background-color: #16162a;">
    <a href="/" class="site_title" style="color: #ffffff; font-weight: 500;"> <span><i class="fa fa-laptop" style="color: #64ffda;"></i>{{ settings.name }}</span></a>
  </div>

  <div class="clearfix"></div>

  <!-- menu profile quick info -->

  <!-- /menu profile quick info -->

  <!-- sidebar menu -->
  <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
    <div class="menu_section">
      <ul class="nav side-menu" id="sidebar_menus">

      </ul>
    </div>

  </div>
  <!-- /sidebar menu -->

  <!-- /menu footer buttons -->
  <div class="sidebar-footer hidden-small" style="height: 40px; background-color: #16162a;">

  </div>
  <!-- /menu footer buttons -->
</div>

<style>
.side-menu {
  text-align: left;
}
.side-menu > li {
  display: block;
  width: 100%;
  text-align: left;
}
.side-menu > li > a {
  color: #ccd6f6;
  padding: 12px 15px;
  font-size: 15px;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  transition: all 0.2s ease;
  background-color: transparent;
}
.side-menu > li > a:hover {
  background-color: rgba(100, 255, 218, 0.08);
  color: #64ffda;
}
.side-menu > li.active > a {
  color: #64ffda;
}
.side-menu > li > a > i {
  margin-right: 8px;
  font-size: 16px;
}
.side-menu > li > a > span:not(.fa) {
  font-size: 13px;
}
.side-menu > li > a > span.fa {
  display: none;
}
.child_menu {
  background-color: rgba(22, 22, 42, 0.95);
  display: none;
  text-align: left;
}
.child_menu.show {
  display: block;
}
.nav.child_menu > li {
  display: block;
  text-align: left;
  padding-left: 0 !important;
}
.nav.child_menu > li > a {
  color: #8892b0;
  padding: 10px 15px 10px 50px !important;
  font-size: 13px;
  display: flex;
  align-items: center;
  justify-content: flex-start;
}
.nav.child_menu > li > a:hover {
  color: #64ffda;
  background-color: rgba(100, 255, 218, 0.08);
}
</style>

<script>
    let is_superuser = 0;
    let permissions = {};
    try {
        let _is_superuser = "{{ request.session.user.is_superuser }}";
        if(_is_superuser  === "True"){
            is_superuser = 1;
        }else{
            is_superuser = parseInt(_is_superuser)
        }
    }catch (e) {
        console.log("sidebar.html error:",e)
    }
    try {
        {% for p in request.session.user.permissions %}
            permissions["{{ p.codename }}"] = {
                "name":"{{ p.name }}",
                "codename":"{{ p.codename }}"
            }
        {% endfor %}
    }catch (e) {
        console.log("sidebar.html error:",e)
    }

    let eleSidebarMenus= document.getElementById("sidebar_menus");
    let html = "";
    if(is_superuser || permissions["/"] || permissions["/dashboard"]) {
        html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-home\"></i> 主页 <span class=\"fa fa-chevron-down\"></span></a>";
            html += "<ul class=\"nav child_menu\">";
            if (is_superuser || permissions["/"]) {
                html += "<li><a href=\"/\">控制面板</a></li>";
            }
            if (is_superuser || permissions["/dashboard"]) {
                html += "<li><a href=\"/dashboard\">大屏管理</a></li>";
            }
            html += "</ul>";
        html += "</li>";
    }
    if(is_superuser || permissions["/alarm/index"] || permissions["/alarmInterface/index"]) {
        html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-bullhorn\"></i> 报警管理 <span class=\"fa fa-chevron-down\"></span></a>";
            html += "<ul class=\"nav child_menu\">";
            if (is_superuser || permissions["/alarm/index"]) {
                html += "<li><a href=\"/alarm/index\">报警管理</a></li>";
            }
            if (is_superuser || permissions["/alarmInterface/index"]) {
                html += "<li><a href=\"/alarmInterface/index\">报警存储管理</a></li>";
            }
            html += "</ul>";
        html += "</li>";
    }
    if(is_superuser || permissions["/algorithmFlow/test"] || permissions["/algorithmFlow/index"] || permissions["/algorithm/index"] || permissions["/behaviour/index"]
    ) {
        html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-eye\"></i> 算法管理 <span class=\"fa fa-chevron-down\"></span></a>";
            html += "<ul class=\"nav child_menu\">";
            if (is_superuser || permissions["/algorithmFlow/test"]) {
                html += "<li><a href=\"/algorithmFlow/test\">算法测试</a></li>";
            }
            if (is_superuser || permissions["/algorithmFlow/index"]) {
                html += "<li><a href=\"/algorithmFlow/index\">业务算法管理</a></li>";
            }

            if (is_superuser || permissions["/algorithm/index"]) {
                html += "<li><a href=\"/algorithm/index\">基础算法管理</a></li>";
            }

            if (is_superuser || permissions["/behaviour/index"]) {
                html += "<li><a href=\"/behaviour/index\">行为算法管理</a></li>";
            }
            if (is_superuser || permissions["/llm/index"]) {
                html += "<li><a href=\"/llm/index\">大模型管理</a></li>";
            }
            html += "</ul>";
        html += "</li>";
    }
    if(is_superuser || permissions["/stream/online"] || permissions["/stream/index"] || permissions["/stream/player"]
        || permissions["/streamRecord/index"] || permissions["/streamRecord/timeplayer"]
    ) {
        html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-video-camera\"></i> 视频管理 <span class=\"fa fa-chevron-down\"></span></a>";
        html += "<ul class=\"nav child_menu\">";
        if (is_superuser || permissions["/stream/online"]) {
            html += "<li><a href=\"/stream/online\">在线预览</a></li>";
        }
        if (is_superuser || permissions["/stream/index"]) {
            html += "<li><a href=\"/stream/index\">摄像头管理</a></li>";
        }
        if (is_superuser || permissions["/stream/player"]) {
            html += "<li><a href=\"/stream/player\">单屏播放器</a></li>";
        }

        if (is_superuser || permissions["/streamRecord/index"]) {
            html += "<li><a href=\"/streamRecord/index\">录像计划管理</a></li>";
        }
        if (is_superuser || permissions["/streamRecord/timeplayer"]) {
            html += "<li><a href=\"/streamRecord/timeplayer\">录像播放器</a></li>";
        }
        html += "</ul>";
        html += "</li>";
    }
    if(is_superuser || permissions["/control/index"] ) {
        html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-cube\"></i> 布控管理 <span class=\"fa fa-chevron-down\"></span></a>";
        html += "<ul class=\"nav child_menu\">";
        if (is_superuser || permissions["/control/index"]) {
            html += "<li><a href=\"/control/index\">布控管理</a></li>";
        }
        html += "</ul>";
        html += "</li>";
        }
        if(is_superuser || permissions["/audio/index"]) {
            html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-music\"></i> 音频管理 <span class=\"fa fa-chevron-down\"></span></a>";
                html += "<ul class=\"nav child_menu\">";
                if (is_superuser || permissions["/audio/index"]) {
                    html += "<li><a href=\"/audio/index\">音频管理</a></li>";
                }
                html += "</ul>";
            html += "</li>";
        }
        if(is_superuser || permissions["/face/index"]) {
            html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-user-plus\"></i> 人脸管理 <span class=\"fa fa-chevron-down\"></span></a>";
                html += "<ul class=\"nav child_menu\">";
                if (is_superuser || permissions["/face/index"]) {
                    html += "<li><a href=\"/face/index\">人脸管理</a></li>";
                }
                html += "</ul>";
            html += "</li>";
        }
       if(is_superuser || permissions["/scheduleTask/index"]) {
            html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-clock-o\"></i> 计划任务 <span class=\"fa fa-chevron-down\"></span></a>";
                html += "<ul class=\"nav child_menu\">";
                if (is_superuser || permissions["/scheduleTask/index"]) {
                    html += "<li><a href=\"/scheduleTask/index\">计划任务</a></li>";
                }
                html += "</ul>";
            html += "</li>";
        }
        if(is_superuser || permissions["/user/index"] || permissions["/user/permission"] || permissions["/user/log"]) {
            html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-user\"></i> 用户管理 <span class=\"fa fa-chevron-down\"></span></a>";
            html += "<ul class=\"nav child_menu\">";
            if (is_superuser || permissions["/user/index"]) {
                html += "<li><a href=\"/user/index\">用户管理</a></li>";
            }
            if (is_superuser || permissions["/user/permission"]) {
                html += "<li><a href=\"/user/permission\">权限管理</a></li>";
            }
            if (is_superuser || permissions["/user/log"]) {
                html += "<li><a href=\"/user/log\">日志管理</a></li>";
            }
            html += "</ul>";
            html += "</li>";
        }


        if(is_superuser || permissions["/system/config"] || permissions["/system/settings"] || permissions["/auth/index"] || permissions["/version/index"]) {
            html += "<li><a href=\"javascript:void(0);\" onclick=\"toggleMenu(this, event)\"><i class=\"fa fa-gear\"></i> 系统功能 <span class=\"fa fa-chevron-down\"></span></a>";
                html += "<ul class=\"nav child_menu\">";
                if (is_superuser || permissions["/system/config"]) {
                    html += "<li><a href=\"/system/config\">启动配置</a></li>";
                }
                if (is_superuser || permissions["/system/settings"]) {
                    html += "<li><a href=\"/system/settings\">系统设置</a></li>";
                }
                if (is_superuser || permissions["/auth/index"]) {
                    html += "<li><a href=\"/auth/index\">系统授权</a></li>";
                }
                if (is_superuser || permissions["/version/index"]) {
                    html += "<li><a href=\"/version/index\">关于系统</a></li>";
                }
                html += "</ul>";
            html += "</li>";
        }


    eleSidebarMenus.innerHTML = html
    
    function toggleMenu(element, event) {
        event.preventDefault();
        event.stopPropagation();
        
        var submenu = element.nextElementSibling;
        var isSameMenu = element.classList.contains('active');
        
        if (submenu && submenu.classList.contains('child_menu')) {
            if (isSameMenu) {
                element.classList.remove('active');
                submenu.classList.remove('show');
            } else {
                element.classList.add('active');
                submenu.classList.add('show');
                
                document.querySelectorAll('.side-menu > li > a').forEach(function(el) {
                    if (el !== element) {
                        el.classList.remove('active');
                        var sibSubmenu = el.nextElementSibling;
                        if (sibSubmenu && sibSubmenu.classList.contains('child_menu')) {
                            sibSubmenu.classList.remove('show');
                        }
                    }
                });
            }
        }
    }



</script>
